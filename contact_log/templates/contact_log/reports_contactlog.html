{% extends "base.html" %}
{% load bootstrap3 %}


{% block content %}
<div>
    <div hidden id="endpoint" value="{{ report_endpoint }}"></div>

    <div id="filter_widget">
        <form onsubmit="filter(event)" id="filter_form">
          ID: <br><input type="text" id="fname" name="id"><br>
          Start Date: <br><input type="date" id="sdate" name="date__gte"><br>
          End Date: <br><input type="date" id="edate" name="date__lte"><br>
          Contact Code: <br><input type="text" id="ccode" name="contactCode"><br>
          <button type="submit">Submit</button>
        </form>
    </div>

    <div id="prompt_section" hidden>
        <button class="btn-default" onclick="">Generate Report</button>
    </div>


    <div class="col">
        <table id="data-table" border="2"><!----- INSERT TABLE ------></table>
    </div>

</div>
{% endblock %}

{% block scripts %}
<script type="text/javascript">
    /**
     * Purpose: Does an AJAX request to the server (specifically to the DRF endpoint)
     * @param e - event - used cancel the default form behavior.
     *            DOCS: https://developer.mozilla.org/en/docs/Web/API/Event/preventDefault
     */
    var data_response;
    function filter(e) {
        e.preventDefault();
        var xhr = new XMLHttpRequest();
        xhr.open('GET', $("#endpoint").attr("value") +"?" + $("form").serialize(), true);
        xhr.onload = function () {
          // Request finished. Do processing here.
            data_response = JSON.parse(this.responseText);
            table_display();
        };
        console.log($("form").serialize());
        xhr.send(null);
    } // TODO: This is my implementaiton of filtering. Feel free to remove this later.

    // Display the table representation of the pdf here.
    function table_display(){
        var dtable = $("#data-table");
        dtable.empty();
        var ele = $('<thead></thead>');
        ele.append($('<th>ID</th>'));
        ele.append($('<th>Date</th>'));
        ele.append($('<th>Description</th>'));
        ele.append($('<th>Contact Code</th>'));
        ele.append($('<th>Case</th>'));
        dtable.append(ele);
        var tbody = $('<tbody></tbody>');
        data_response.results.forEach(function (val) {
            var ele = $('<tr></tr>');
            ele.append($("<td></td>").text(val.id));
            ele.append($("<td></td>").text(val.date));
            ele.append($("<td></td>").text(val.description));
            ele.append($("<td></td>").text(val.contactCode));;
            ele.append($("<td></td>").text("INSERT_CASE"));;
            tbody.append(ele);
        });
        dtable.append(tbody);
    }

</script>
{% endblock %}